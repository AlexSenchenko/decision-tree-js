<html>

<script src="decision-tree.js"></script>

<style>
canvas {
    border: 1px solid #ccc;
    margin: 30px;
}

select {
    margin: 30px;
}
</style>

<script>
function init() {
    
    function hexToRgb(hex) {
        // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
        var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
        hex = hex.replace(shorthandRegex, function(m, r, g, b) {
                          return r + r + g + g + b + b;
                          });
                          
                          var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                          return result ? {
                              r: parseInt(result[1], 16),
                              g: parseInt(result[2], 16),
                              b: parseInt(result[3], 16)
                          } : null;
    }
    
    var canv = document.getElementById('myCanvas'),
        colorSelect = document.getElementById('colorSelect'),
        clearBtn = document.getElementById('clearBtn'),
        context = canv.getContext('2d'),
        elements = [],
        color = colorSelect.options[colorSelect.selectedIndex].value,
        radius = 3,
        points = [],
        tree = null;
        
    // Default set of predicates is: '==', '>=' and '<='
    // But each point have only continuous attributes: x, y
    // So, we will use only '>=' and '<=' predicates
    delete predicates['=='];
    
    function circle(x, y, col) {
        context.beginPath();
        context.arc(x, y, radius, 0, 2 * Math.PI, false);

        var c = hexToRgb(col)
        context.fillStyle = 'rgb(' + c.r + ',' + c.g + ',' + c.b + ')';
        
        context.fill();
        context.stroke();
    }
    
    function rebuildAndDisplayTree() {
        addingPoints = false;
        tree = buildTree(points, 1, 'color');
        displayTreePredictions();
        displayPoints();
    }
    
    function displayTreePredictions() {
        context.clearRect ( 0 , 0 , canv.width , canv.height );
        
        for(var x = 0; x < canv.width; x++) {
            for(var y = 0; y < canv.height; y++) {

                var predictedColor = predict(tree, {x : x, y : y});
                
                // put pixel
                var c = hexToRgb(predictedColor);
                context.fillStyle = 'rgba(' + c.r + ',' + c.g + ',' + c.b + ',' + 0.5 + ')';
                context.fillRect( x, y, 1, 1 );
            }
        }
    }
    
    function displayPoints() {
        for(var p in points) {
            circle(points[p].x, points[p].y, points[p].color);
        }
    }
    
    var addingPoints = false;
    canv.addEventListener('mousedown',
                          function(e){
                          addingPoints = true;
                          });
    
    canv.addEventListener('mouseup', rebuildAndDisplayTree);

    canv.addEventListener('mouseout', rebuildAndDisplayTree);
    
    canv.addEventListener('mousemove',
                          function(e) {
                            if(addingPoints) {
                                var x = event.pageX - canv.offsetLeft,
                                    y = event.pageY - canv.offsetTop;
                                    circle(x, y, color);
                                    points.push({x : x, y : y, color : color});
                            }
                          });

    colorSelect.addEventListener('change',
                                 function(event) {
                                    color = colorSelect.options[colorSelect.selectedIndex].value;
                                 });

    clearBtn.addEventListener('click',
                             function(event) {
                                context.clearRect ( 0 , 0 , canv.width , canv.height );
                                points = [];
                             });
}
</script>

<body onload="init()">
    
	<select id="colorSelect">
		<option value="#33CCFF">Blue</option>
		<option value="#FF6600">Red</option>
        <option value="#009933">Green</option>
	</select>
    
	<button id="clearBtn">clear</button>
    
	<br/>
    
	<canvas id="myCanvas" width="200" height="200"/>
</body>
</html>
