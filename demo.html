<html>

<script src="decision-tree.js"></script>

<style>
canvas {
    border: 1px solid #ccc;
    margin: 30px;
}

select {
    margin: 30px;
}
</style>

<script>
function init() {
    
    var canv = document.getElementById('myCanvas'),
        colorSelect = document.getElementById('colorSelect'),
        demoBtn = document.getElementById('demoBtn'),
        context = canv.getContext('2d'),
        elements = [],
        color = colorSelect.options[colorSelect.selectedIndex].value,
        radius = 3,
        points = [],
        tree = null;
        
    // Default set of predicates is: '==', '>=' and '<='
    // But each point have only continuous attributes: x, y
    // So, we will use only '>=' and '<=' predicates
    delete predicates['=='];
    
    function circle(x, y, col) {
        context.beginPath();
        context.arc(x, y, radius, 0, 2 * Math.PI, false);
        context.fillStyle = col;
        context.fill();
        context.stroke();
    }
    
    function displayTreePredictions() {
        for(var x = 0; x < canv.width; x++) {
            for(var y = 0; y < canv.height; y++) {
                // put pixel
                context.fillStyle = 'light' + predict(tree, {x : x, y : y});
                context.fillRect( x, y, 1, 1 );
            }
        }
    }
    
    function displayPoints() {
        for(var p in points) {
            circle(points[p].x, points[p].y, points[p].color);
        }
    }

    // Add event listener for `click` events.
    canv.addEventListener('click',
                          function(event) {
                            var x = event.pageX - canv.offsetLeft,
                                y = event.pageY - canv.offsetTop;
    
                            circle(x, y, color);

                            points.push({x : x, y : y, color : color});
                          
                            if(tree && predict(tree, {x : x, y : y}) == color) {
                                return;
                            }
                  
                            tree = buildTree(points, 1, 'color');
                      
                            displayTreePredictions();
                      
                            displayPoints();
                          });

    colorSelect.addEventListener('change',
                                 function(event) {
                                    color = colorSelect.options[colorSelect.selectedIndex].value;
                                 });

    demoBtn.addEventListener('click',
                             function(event) {
                                context.fillStyle = 'white';
                                context.fillRect( 0, 0, canv.width, canv.height );
                                points = [];
                             });
}
</script>

<body onload="init()">
    
	<select id="colorSelect">
		<option>green</option>
		<option>blue</option>
	</select>
    
	<button id="demoBtn">clear</button>
    
	<br/>
    
	<canvas id="myCanvas" width="200" height="200" />
</body>
</html>
