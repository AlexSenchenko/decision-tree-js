

var dt=function(){function n(a){var c={"==":function(b,a){return b==a},">=":function(b,a){return b>=a},"<=":function(a,d){return a<=d}};if(a.removeDefaultPredicates)for(var d in a.removeDefaultPredicates)delete c[a.removeDefaultPredicates[d]];d={};if(a.ignoredAttributes)for(var e in a.ignoredAttributes)d[a.ignoredAttributes[e]]=!0;this.root=r({trainingSet:a.trainingSet,categoryAttr:a.categoryAttr?a.categoryAttr:"category",minItemsCount:a.minItemsCount?a.minItemsCount:1,entropyThrehold:a.entropyThrehold? a.entropyThrehold:0.01,maxTreeDepth:a.maxTreeDepth?a.maxTreeDepth:70,predicates:c,ignoredAttributes:d});this.predict=function(a){return p(this.root,a)}}function q(a,c){var d={},e;for(e in a){var b=a[e][c];d[b]=d[b]?d[b]+1:1}return d}function s(a,c){var d=q(a,c),e=0,b;for(b in d)var f=d[b]/a.length,e=e+-f*Math.log(f);return e}function t(a,c){var d=q(a,c),e=0,b,f;for(f in d)d[f]>e&&(e=d[f],b=f);return b}function r(a){var c=a.trainingSet,d=a.minItemsCount,e=a.categoryAttr,b=a.entropyThrehold,f=a.maxTreeDepth, x=a.predicates,p=a.ignoredAttributes;if(0==f||c.length<=d)return{category:t(c,e)};d=s(c,e);if(d<=b)return{category:t(c,e)};var b={gain:0},g;for(g in c){var n=c[g],m;for(m in n)if(m!=e&&!p[m]){var q=n[m],u;for(u in x){var y=x[u],h;h=c;var l=m,v=y,k=q,z=[],A=[],B=void 0;for(B in h){var w=h[B],C=w[l];null!=C&&v(C,k)?z.push(w):A.push(w)}h={match:z,notMatch:A};l=s(h.match,e);v=s(h.notMatch,e);k=0;k+=l*h.match.length;k+=v*h.notMatch.length;k/=c.length;l=d-k;0<l&&b.gain<l&&(b=h,b.predicateName=u,b.predicate= y,b.attribute=m,b.pivot=q,b.gain=l)}}}if(0>=b.gain)return{category:t(c,e)};a.maxTreeDepth=f-1;a.trainingSet=b.match;c=r(a);a.trainingSet=b.notMatch;a=r(a);return{attribute:b.attribute,predicate:b.predicate,predicateName:b.predicateName,pivot:b.pivot,match:c,notMatch:a,matchedCount:b.match.length,notMatchedCount:b.notMatch.length}}function p(a,c){if(a.category)return a.category;var d=c[a.attribute],e=a.predicate,b=a.pivot;return null!=d&&e(d,b)?p(a.match,c):p(a.notMatch,c)}function D(a,c){for(var d= a.trainingSet,e=[],b=0;b<c;b++)e[b]=[];for(b=0;b<d.length;b++)e[b%c].push(d[b]);d=[];for(b=0;b<c;b++){a.trainingSet=e[b];var f=new n(a);d.push(f)}return d}var g={};g.DecisionTree=n;g.RandomForest=function(a,c){this.trees=D(a,c);this.predict=function(a){var c=this.trees,b={},f;for(f in c){var g=c[f].predict(a);b[g]=b[g]?b[g]+1:1}return b}};return g}();